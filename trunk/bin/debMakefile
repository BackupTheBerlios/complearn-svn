#!/usr/bin/make -f
# -*- makefile -*-

all: debs

debs: mdebs cldebs gdebs csdebs

addkey:
	wget -q "http://cilibrar.com/debian/gpgkey-E0CFA8E4.txt" -O - | sudo apt-key add -

mdebs:
	SRCDIRNAME=complearn-mpi ; BUILDDIRNAME=complearn-mpi-0.9.3 ; TARNAME=$${BUILDDIRNAME}.tar.gz ; cd $${SRCDIRNAME} && aclocal && automake -a && autoconf && ./configure --enable-optimize && make dist && cd .. && tar xvfz $${SRCDIRNAME}/$${TARNAME} && cd $${BUILDDIRNAME} && cp -rv ../$${SRCDIRNAME}/debian . && dpkg-buildpackage -isvn/ -us -uc -rfakeroot

gdebs:
	SRCDIRNAME=gui ; BUILDDIRNAME=complearn-gui-0.9.3 ; TARNAME=$${BUILDDIRNAME}.tar.gz ; cd $${SRCDIRNAME} && aclocal && automake && autoconf && ./configure --enable-optimize && make dist && cd .. && tar xvfz $${SRCDIRNAME}/$${TARNAME} && cd $${BUILDDIRNAME} && cp -rv ../$${SRCDIRNAME}/debian . && dpkg-buildpackage -isvn/ -us -uc -rfakeroot

cldebs:
	cd core && aclocal && automake && autoconf && ./configure --enable-optimize && make dist && cd .. && cp core/libcomplearn-0.9.3.tar.gz libcomplearn_0.93.orig.tar.gz && tar xvfz libcomplearn_0.93.orig.tar.gz && cd libcomplearn-0.9.3 && cp -rv ../core/debian . && cd .. && dpkg-source -b -isvn/ libcomplearn-0.9.3 libcomplearn_0.93.orig.tar.gz && cd libcomplearn-0.9.3 && dpkg-buildpackage -isvn/ -us -uc -b -rfakeroot && rm -rf libcomplearn-0.9.3

csdebs:
	cp -rv libcsoap-package/libcsoap libcsoap-1.047 && cd libcsoap-1.047 && cp ../libcsoap-package/extern/*orig.tar.gz ../libcsoap-1.047.orig.tar.gz && dpkg-buildpackage -isvn/ -us -uc -sa -rfakeroot && fakeroot ./debian/rules clean

deploy:
	scp *.deb *.dsc *.changes *gz cilibrar@cilibrar.com:public_html/cilibrarcom/debian/pool/main/l/libcomplearn && ssh cilibrar@cilibrar.com /home/cilibrar/bin/upa pkgarc main

clean:
	rm -rf complearn-mpi-0.9.3 complearn-mpi_0* complearn-mpi-1* complearn-mpi-0.9.3* libcomplearn-0.9.3 complearn-gui-0.93 libcsoap-1.047 complearn-gui* libcomplearn-0.93 comp*.deb libcomp*.deb libcomp*.dsc libcomp*gz libcomp*.changes libcomp.*.dsc libcs*.deb libcs*gz libcs*changes libna*deb libcs*dsc && cd core && fakeroot ./debian/rules clean


